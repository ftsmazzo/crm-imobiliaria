generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id           String    @id @default(uuid())
  email        String    @unique
  senhaHash    String    @map("senha_hash")
  nome         String
  role         String    @default("corretor")
  ativo        Boolean   @default(true)
  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime  @updatedAt @map("atualizado_em")
  contatos     Contato[]
  imoveis      Imovel[]
  tarefas      Tarefa[]
}

model Contato {
  id                   String    @id @default(uuid())
  nome                 String
  email                String
  telefone             String?
  origem               String?
  observacoes          String?   @map("observacoes")
  estagio              String    @default("novo") // novo, qualificado, visita, proposta, fechado
  usuarioResponsavelId String?   @map("usuario_responsavel_id")
  criadoEm             DateTime  @default(now()) @map("criado_em")
  atualizadoEm         DateTime  @updatedAt @map("atualizado_em")
  usuarioResponsavel   Usuario?  @relation(fields: [usuarioResponsavelId], references: [id])
  interesses           Interesse[]
  tarefas              Tarefa[]
}

model Proprietario {
  id            String    @id @default(uuid())
  nome          String
  cpf           String?    @db.VarChar(14)
  rg            String?    @db.VarChar(20)
  dataNascimento DateTime? @map("data_nascimento") @db.Date
  estadoCivil   String?    @map("estado_civil") @db.VarChar(20)
  telefone      String?
  telefone2     String?    @map("telefone2")
  email         String?
  endereco      String?    @db.Text
  observacoes   String?    @db.Text
  tipo          String?    @default("PF") // PF ou PJ
  razaoSocial   String?    @map("razao_social")
  cnpj          String?    @db.VarChar(18)
  inscricaoEstadual String? @map("inscricao_estadual")
  repLegalNome  String?    @map("rep_legal_nome")
  repLegalCpf   String?    @map("rep_legal_cpf") @db.VarChar(14)
  repLegalContato String?  @map("rep_legal_contato")
  repLegalEmail String?    @map("rep_legal_email")
  criadoEm      DateTime   @default(now()) @map("criado_em")
  atualizadoEm  DateTime   @updatedAt @map("atualizado_em")
  imoveis       Imovel[]

  @@map("proprietario")
}

model Empreendimento {
  id          String   @id @default(uuid())
  nome        String
  descricao   String?  @db.Text
  endereco    String?  @map("endereco") @db.Text
  criadoEm    DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")
  imoveis     Imovel[]

  @@map("empreendimento")
}

model Imovel {
  id                    String    @id @default(uuid())
  tipo                  String    // casa, apartamento, terreno, casa_condominio, terreno_condominio, comercial
  rua                   String?
  numero                String?
  complemento           String?   @db.VarChar(100)
  bairro                String?
  cidade                String?
  cep                   String?
  valorVenda            Decimal?  @map("valor_venda") @db.Decimal(14, 2)
  valorAluguel          Decimal?  @map("valor_aluguel") @db.Decimal(14, 2)
  valorIptu             Decimal?  @map("valor_iptu") @db.Decimal(14, 2)
  valorCondominio       Decimal?  @map("valor_condominio") @db.Decimal(14, 2)
  status                String    @default("disponivel")
  codigo                String?
  quadra                String?
  lote                  String?
  numeroMatricula       String?   @map("numero_matricula")
  numeroIptu            String?   @map("numero_iptu") @db.VarChar(30)
  cartorio              String?   @db.VarChar(100)
  tipoListing           String?   @map("tipo_listing") // residencial, comercial, rural, terreno, outro
  subtipo               String?   @map("subtipo") @db.VarChar(80)
  exibirEnderecoSite    Boolean?  @map("exibir_endereco_site") @default(true)
  descricao             String?   @db.Text
  qtdQuartos            Int?      @map("qtd_quartos")
  qtdBanheiros          Int?      @map("qtd_banheiros")
  qtdSalas              Int?      @map("qtd_salas")
  lavabo                Int?      @default(0)
  qtdVagas              Int?      @map("qtd_vagas")
  tipoVaga              String?   @map("tipo_vaga") // coberta, descoberta, ambos
  area                  Decimal?  @db.Decimal(10, 2)
  areaTerreno           Decimal?  @map("area_terreno") @db.Decimal(10, 2)
  anoConstrucao         Int?      @map("ano_construcao")
  tipoPiso              String?   @map("tipo_piso")
  pontosReferencia      String?   @map("pontos_referencia") @db.VarChar(200)
  eletrodomesticos      String?   @map("eletrodomesticos") @db.Text
  andarUnidade          Int?      @map("andar_unidade")
  qtdAndares            Int?      @map("qtd_andares")
  totalUnidades         Int?      @map("total_unidades")
  qtdTorres             Int?      @map("qtd_torres")
  caracteristicas       String?   @map("caracteristicas") @db.Text // JSON array: ["churrasqueira","piscina",...]
  empreendimentoId      String?   @map("empreendimento_id")
  proprietarioId        String?   @map("proprietario_id")
  usuarioResponsavelId  String?   @map("usuario_responsavel_id")
  criadoEm              DateTime  @default(now()) @map("criado_em")
  atualizadoEm          DateTime  @updatedAt @map("atualizado_em")
  usuarioResponsavel    Usuario?  @relation(fields: [usuarioResponsavelId], references: [id])
  empreendimento        Empreendimento? @relation(fields: [empreendimentoId], references: [id], onDelete: SetNull)
  proprietario          Proprietario? @relation(fields: [proprietarioId], references: [id], onDelete: SetNull)
  fotos                 ImovelFoto[]
  documentos            ImovelDocumento[]
  interesses            Interesse[]
  tarefas               Tarefa[]
}

model ImovelDocumento {
  id        String   @id @default(uuid())
  imovelId  String   @map("imovel_id")
  tipo      String   // iptu, autorizacao
  key       String   // objeto no storage (ex: imoveis/uuid/documentos/nome.pdf)
  nome      String?  // nome original do arquivo
  criadoEm  DateTime @default(now()) @map("criado_em")
  imovel    Imovel   @relation(fields: [imovelId], references: [id], onDelete: Cascade)

  @@map("imovel_documento")
}

model ImovelFoto {
  id        String   @id @default(uuid())
  imovelId  String   @map("imovel_id")
  key       String   // objeto no MinIO (ex: imoveis/uuid/nome-arquivo.jpg)
  ordem     Int      @default(0)
  criadoEm  DateTime @default(now()) @map("criado_em")
  imovel    Imovel   @relation(fields: [imovelId], references: [id], onDelete: Cascade)

  @@map("imovel_foto")
}

model Tarefa {
  id           String    @id @default(uuid())
  titulo       String
  descricao    String?
  dataPrevista DateTime? @map("data_prevista") @db.Date
  concluida    Boolean   @default(false)
  usuarioId    String    @map("usuario_id")
  contatoId    String?   @map("contato_id")
  imovelId     String?   @map("imovel_id")
  criadoEm     DateTime  @default(now()) @map("criado_em")
  usuario     Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  contato     Contato?  @relation(fields: [contatoId], references: [id], onDelete: SetNull)
  imovel      Imovel?   @relation(fields: [imovelId], references: [id], onDelete: SetNull)
}

model Interesse {
  id        String   @id @default(uuid())
  tipo      String   @default("interesse") // interesse, proposta
  valor     Decimal? @db.Decimal(14, 2)
  status    String?  // enviada, aceita, recusada
  observacao String?
  contatoId String   @map("contato_id")
  imovelId  String   @map("imovel_id")
  criadoEm  DateTime @default(now()) @map("criado_em")
  contato   Contato  @relation(fields: [contatoId], references: [id], onDelete: Cascade)
  imovel    Imovel   @relation(fields: [imovelId], references: [id], onDelete: Cascade)
}
